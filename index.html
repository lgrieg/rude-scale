<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–®–∫–∞–ª–∞ –≥—Ä—É–±–∏—è–Ω—Å—Ç–≤–∞</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .entry { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>üßÇ –®–∫–∞–ª–∞ –≥—Ä—É–±–∏—è–Ω—Å—Ç–≤–∞</h1>
  <input type="text" id="nameInput" placeholder="–ò–º—è –≥—Ä—É–±–∏—è–Ω–∞" />
  <button onclick="addRudePerson()">–î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–±–∏—è–Ω–∞</button>
  <hr />
  <div id="rudeList"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCOxEiESJZ6NiXEtYgaee7Uyzr2TN95M-0",
      authDomain: "rudelist-77a84.firebaseapp.com",
      databaseURL: "https://rudelist-77a84-default-rtdb.europe-west1.firebasedatabase.app/",
      projectId: "rudelist-77a84",
      storageBucket: "rudelist-77a84.appspot.com",
      messagingSenderId: "668098940323",
      appId: "1:668098940323:web:af4b90c4b480ac02765e16"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function renderList(data) {
    const container = document.getElementById("rudeList");
    container.innerHTML = "";

    const sorted = Object.entries(data).sort((a, b) => b[1] - a[1]);

    sorted.forEach(([name, count], index) => {
        // ‚ùó –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ –º–µ–Ω—å—à–µ 0
        if (count < 0) {
        db.ref("rudePeople/" + name).remove();
        return; // –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ—Ç—Ä–∏—Å–æ–≤–∫—É
        }

        let medal = "";
        if (index === 0) medal = " ü•á";
        else if (index === 1) medal = " ü•à";
        else if (index === 2) medal = " ü•â";

        const div = document.createElement("div");
        div.className = "entry";
        div.innerHTML = `
        <strong>${medal}${name}</strong>: ${count}
        <button onclick="increase('${name}', ${count})">+1</button>
        <button onclick="confirmDelete('${name}', ${count})">–£–ë–ï–†–ò–¢–ï!!!!</button>
        `;
        container.appendChild(div);
    });
    }


    function addRudePerson() {
      const name = document.getElementById("nameInput").value.trim();
      if (!name) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è");
      db.ref("rudePeople/" + name)
        .set(0)
        .then(() => console.log("–ì—Ä—É–±–∏—è–Ω –¥–æ–±–∞–≤–ª–µ–Ω"))
        .catch((err) => console.error("–û—à–∏–±–∫–∞:", err));
      document.getElementById("nameInput").value = "";
    }

    function increase(name, current) {
      db.ref("rudePeople/" + name).set(current + 1);
    }

    function confirmDelete(name, current) {
      const answer = prompt(`–£ —Ç–µ–±—è –µ—Å—Ç—å —à–∞–Ω—Å –∏—Å–ø—Ä–∞–≤–∏—Ç—å—Å—è. –û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å "${name}"!\n–ú–æ–∂–Ω–æ –ª–∏ –≥—Ä—É–±–∏—è–Ω–Ω–∏—á–∞—Ç—å?\n\n–í–∞—Ä–∏–∞–Ω—Ç—ã:\n‚Äî –¥–∞\n‚Äî –Ω–µ—Ç\n‚Äî –∏–¥–∏ –Ω–∞—Ö—É–π`);

      if (!answer) return;

      const norm = answer.trim().toLowerCase();

      if (norm === "–¥–∞") {
        db.ref("rudePeople/" + name).set(current + 5);
        alert(`${name} –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (+5 –∫ –≥—Ä—É–±–∏—è–Ω—Å—Ç–≤—É)!`);
      } else if (norm === "–Ω–µ—Ç") {
        db.ref("rudePeople/" + name).set(current - 5);
        alert(`${name} —Å—Ç–∞–ª –µ—â—ë –ø—Ä–∏–ª–∏—á–Ω–µ–µ (-5 –∫ –≥—Ä—É–±–∏—è–Ω—Å—Ç–≤—É)!`);
      } else if (norm === "–∏–¥–∏ –Ω–∞—Ö—É–π") {
        db.ref("rudePeople/" + name).set(current + 100);
        alert(`${name} –ø–æ–ª—É—á–∏–ª +100 –∑–∞ —Ö–∞–º—Å—Ç–≤–æ üòà`);
      } else {
        alert("–û—Ç–≤–µ—Ç –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω.");
      }
    }

    db.ref("rudePeople").on("value", (snapshot) => {
      const data = snapshot.val() || {};
      renderList(data);
    });
  </script>
</body>
</html>
